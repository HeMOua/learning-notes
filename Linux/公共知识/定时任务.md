# 定时任务

## `crontab`基础

CRON 表达式是一个字符串，包含五个到七个由空格分隔的字段（每种软件不一样），表示一组时间，通常作为执行某个程序的时间表。

注释以注释标记#开始，并且必须单独在一行上。

+ Linux： `0 */12 * * * [user] [command]` 

+ Java(Spring)： `0 0 */12 * * *` 

+ Java(Quartz)： `0 0 18 L * ?` 

```
例子：
    # 每月的最后1天
    0 0 L * * *

    说明：
    Linux
    *    *    *    *    *
    -    -    -    -    -
    |    |    |    |    |
    |    |    |    |    +----- day of week (0 - 7) (Sunday=0 or 7) OR 
    |    |    |    |           sun,mon,tue,wed,thu,fri,sat
    |    |    |    +---------- month (1 - 12) OR jan,feb,mar,apr ...
    |    |    +--------------- day of month (1 - 31)
    |    +-------------------- hour (0 - 23)
    +------------------------- minute (0 - 59)

```
### 字段含义


| 字段                                | 是否必填 | 允许值          | 允许特殊字符        | 备注                                                         |
| :---------------------------------- | :------- | :-------------- | :------------------ | :----------------------------------------------------------- |
| Seconds                             | 是       | 0–59            | `*`,`-`             | 标准实现不支持此字段。                                       |
| <font color=red>Minutes</font>      | 是       | 0–59            | `*`,`-`             |                                                              |
| <font color=red>Hours</font>        | 是       | 0–23            | `*`,`-`             |                                                              |
| <font color=red>Day of month</font> | 是       | 1–31            | `*`,`-`,`?`,`L`,`W` | `?`,`L`,`W`只有部分软件实现了                                |
| <font color=red>Month</font>        | 是       | 1–12 or JAN–DEC | `*`,`-`             |                                                              |
| <font color=red>Day of week</font>  | 是       | 0–7 or SUN–SAT  | `*`,`-`,`?`,`L`,`#` | `?`,`L`,`#`只有部分软件实现了 Linux和Spring的允许值为0-7，0和7为周日 Quartz的允许值为1-7，1为周日 |
| Year                                | 否       | 1970–2099       | `*`,`-`             | 标准实现不支持此字段。                                       |

### 标准字段

+ **逗号**用于分隔列表。例如，在第5个字段(星期几)中使用 `MON,WED,FRI` 表示周一、周三和周五。

+ **连字符**定义范围。例如，`2000-2010` 表示2000年至2010年期间的每年，包括2000年和2010年。

除非用反斜杠`\`转义，否则命令中的**百分号(%)**会被替换成换行符，第一个百分号后面的所有数据都会作为标准输入发送给命令。

### 非标准字段

+ **L** 代表“Last”。当在星期几字段中使用的时候，可以指定给定月份的结构，例如：
  + “最后一个星期五”(`5L`)。在月日字段中，可以指定一个月的最后一天。

+ “day of month”字段可以使用**“W”**字符。指定最接近给定日期的工作日（星期一-星期五）。例如：
  + `15W`，意思是：“最接近该月15日的工作日。”；所以，如果15号是星期六，触发器在14号星期五触发。如果15日是星期天，触发器在16日星期一触发。如果15号是星期二，那么它在15号星期二触发。
  + `1W`，如果这个月的第一天是星期六，不会跨到上个月，触发器会在这个月的第三天（也就是星期一）触发。只有指定一天（不能是范围或列表）的时候，才能指定“W”字符。

+ 星期几字段可以使用**“#”**，后面必须跟一个介于1和5之间的数字。例如，`5#3`表示每个月的第三个星期五。

+ 在某些实现中，`?` 用来代替 `*` 以将月中的某一天或周中的某一天留空。其他 cron 的实现是替换 `?` 为 cron 守护进程的启动时间，例如：
  + `？？* * * *`，如果 cron 在上午 8:25 启动，将更新为 `25 8 * * * *` 并在每天的这个时间运行，直到再次重新启动。

+ 分钟字段设置 `*/5`表示每5分钟一次，注意：这里指的是能被5整除的分钟数。

## 例子

### Linux

`crontab -e` 进入编辑

```
0 2 * * 1,3,5 /opt/docker-sh/clean_docker_log.sh
```

每周 1 3 5 的晚上 2 点执行脚本

`crontab -l` 查看所有脚本