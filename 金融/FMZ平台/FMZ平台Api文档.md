# FMZ平台Api文档

## 全局变量

### `exchange`

`exchange`表示一个交易所对象，默认为【配置策略参数】中所配置的【第一个】交易所对象。所有与交易所的交互都通过这个对象里面的函数实现。一个交易所对象绑定一个期货账户。

### `exchanges`

`exchanges`表示一个数组对象，包含了我们【配置策略参数】中所配置的【所有】交易所对象。

```python
for i in range(len(exchanges)):
        Log("添加的交易所对象索引(第一个为0以此类推)：", i, "名称：", exchanges[i].GetName(), "标签：", exchanges[i].GetLabel())
```

### 订单状态

`Order`结构中的`Status`属性。

| 常量名               | 定义                 | 值   |
| :------------------- | :------------------- | :--- |
| ORDER_STATE_PENDING  | 未完成               | 0    |
| ORDER_STATE_CLOSED   | 已经完成             | 1    |
| ORDER_STATE_CANCELED | 已经取消             | 2    |
| ORDER_STATE_UNKNOWN  | 未知状态（其它状态） | 3    |

**ORDER_STATE_UNKNOWN** 状态，可以调用`exchange.GetRawJSON()`获取原始订单状态信息，查询交易所文档，查看具体描述。

表格中的常量名可以直接在策略代码中用于和`Order`结构的`Status`属性比较、判断是否相等从而确定订单状态。打印这些常量名会显示这些**常量名**对应的值.

###  订单买卖类型

`Order`结构中的`Type`属性。

| 常量名          | 定义 | 值   |
| :-------------- | :--- | :--- |
| ORDER_TYPE_BUY  | 买单 | 0    |
| ORDER_TYPE_SELL | 卖单 | 1    |

### 期货开平仓方向

`Order`结构中的`Offset`属性。

| 常量名             | 定义       | 值   |
| :----------------- | :--------- | :--- |
| ORDER_OFFSET_OPEN  | 开仓的订单 | 0    |
| ORDER_OFFSET_CLOSE | 平仓的订单 | 1    |

### 仓位类型

`Position`结构中的`Type`属性。

| 常量名      | 定义         | 说明                                                      | 适用     | 值   |
| :---------- | :----------- | :-------------------------------------------------------- | :------- | :--- |
| PD_LONG     | 多头仓位     | CTP用exchange.SetDirection("closebuy_today")设置平仓方向  | 商品期货 | 0    |
| PD_SHORT    | 空头仓位     | CTP用exchange.SetDirection("closesell_today")设置平仓方向 | 商品期货 | 1    |
| PD_LONG_YD  | 昨日多头仓位 | CTP用exchange.SetDirection("closebuy")设置平仓方向        | 商品期货 | 2    |
| PD_SHORT_YD | 昨日空头仓位 | CTP用exchange.SetDirection("closesell")设置平仓方向       | 商品期货 | 3    |

> 1. 多头仓位（Long Position）： 多头仓位指的是投资者购买了某个资产或证券，期望其价格上涨，从而能够在未来以更高的价格出售获得利润。当投资者持有多头仓位时，他们是看涨的，相信该资产的价值会增加。例如，如果一个投资者购买了100股某公司的股票，并且预期股票价格将上涨，那么这个投资者就持有了100股的多头仓位。
> 2. 空头仓位（Short Position）： 空头仓位指的是投资者借入某个资产或证券，并立即卖出，期望在未来该资产的价格下跌时再以更低的价格买回，从而获得利润。当投资者持有空头仓位时，他们是看跌的，相信该资产的价值会下降。例如，一个投资者借入100股某公司的股票并立即卖出，然后预期股票价格将下跌，之后以更低的价格买回100股的股票来还给出借者，这个投资者就持有了100股的空头仓位。
>
> **总结**：
>
> - 多头仓位：买入资产，看涨，期望价格上涨获利。
> - 空头仓位：卖出资产，看跌，期望价格下跌获利。

## 数据结构

> 部分函数会附带在调用时请求返回的原始`JSON`数据，该原始`JSON`数据储存在返回对象的`Info`属性中。回测时由于并不是访问某个交易所的接口，所以回测时返回的数据中无`Info`属性，以下是各个数据结构的主要属性描述。

### Trade

获取所有交易历史（非自己），由`exchange.GetTrades()`函数返回。商品期货、股票证券不支持该函数。

```javascript
{
    Id      : 9585306,          // 交易记录ID
    Time    : 1567736576000,    // 时间(Unix timestamp 毫秒)
    Price   : 1000,             // 价格
    Amount  : 1,                // 数量
    Type    : 0                 // 订单类型,参考常量里的订单类型,0即为ORDER_TYPE_BUY，ORDER_TYPE_BUY的值为0
}
```

### Ticker

市场行情由`exchange.GetTicker()`函数返回。

```javascript
{
    Info    : {...},             // 请求交易所接口后，交易所接口应答的原始数据，回测时无此属性
    High    : 1000,              // 最高价
    Low     : 500,               // 最低价
    Sell    : 900,               // 卖一价
    Buy     : 899,               // 买一价
    Last    : 900,               // 最后成交价
    Volume  : 10000000,          // 最近成交量
    Time    : 1567736576000      // 毫秒级别时间戳
}
```

> 当获取市场行情时，交易所通常会返回一个类似于上述代码所示的数据结构。这个数据结构包含了一些关键的市场信息，用于描述特定交易品种（如股票、期货、或其他资产）的当前状态。以下是一个简单的示例：
>
> 假设我们正在获取一只股票的市场行情，该股票的代码是 "ABC"：
>
> ```
> {
>     Info    : {...},             // 请求交易所接口后，交易所接口应答的原始数据，回测时无此属性
>     High    : 1000,              // 最高价
>     Low     : 500,               // 最低价
>     Sell    : 900,               // 卖一价（卖方愿意出售的最高价格）
>     Buy     : 899,               // 买一价（买方愿意购买的最高价格）
>     Last    : 900,               // 最后成交价（最近一笔交易的价格）
>     Volume  : 10000000,          // 最近成交量（最近一笔交易的交易量）
>     Time    : 1567736576000      // 毫秒级别时间戳（行情数据的时间戳）
> }
> ```
>
> 在这个例子中，我们可以解释这些字段的含义：
> - "High"：代表股票在一段时间内的最高价格是 1000。
> - "Low"：代表股票在一段时间内的最低价格是 500。
> - "Sell"：代表当前卖一价（卖方愿意出售的最高价格）是 900。
> - "Buy"：代表当前买一价（买方愿意购买的最高价格）是 899。
> - "Last"：代表最后成交价（最近一笔交易的价格）是 900。
> - "Volume"：代表最近成交量（最近一笔交易的交易量）是 10000000。
> - "Time"：代表行情数据的时间戳是 1567736576000，该时间戳是以毫秒为单位的。
>
> 这些市场行情数据对于交易者和分析师来说非常重要，可以帮助他们了解特定交易品种的当前价格水平、交易量以及最近的市场活动情况。在实际的交易和分析过程中，这些数据会被用于制定交易策略、进行技术分析和基本面分析等。

### Record

标准的OHLC结构，用来画K线和指标计算分析。由`exchange.GetRecords()`函数返回此结构的数组。每一个`Record`结构代表一个K线柱，即一根K线BAR。`Record`其中的`Time`为这根K线柱周期的起始时间。

```javascript
{
    Time    : 1567736576000,     // 一个时间戳，精确到毫秒，与Javascript的new Date().getTime()得到的结果格式一样
    Open    : 1000,              // 开盘价
    High    : 1500,              // 最高价
    Low     : 900,               // 最低价
    Close   : 1200,              // 收盘价
    Volume  : 1000000            // 交易量
}
```

> 
> OHLC 结构是一种用于描述金融市场中资产价格波动的数据格式。它是由四个价格数据组成的缩写，分别表示开盘价（Open）、最高价（High）、最低价（Low）和收盘价（Close）。这种数据结构通常用于绘制蜡烛图（Candlestick Chart）和K线图（Kagi Chart），用于分析资产价格的走势和波动情况。
>
> 1. 开盘价（Open）：表示在一段时间（比如一个交易日、一个小时、或其他时间段）的开始时的交易价格。在蜡烛图或K线图上，通常用一条水平线或短的横线来表示。
> 2. 最高价（High）：表示在相同时间段内资产的最高交易价格。在蜡烛图或K线图上，通常用一条上影线（或称为上影线）来表示。
> 3. 最低价（Low）：表示在相同时间段内资产的最低交易价格。在蜡烛图或K线图上，通常用一条下影线（或称为下影线）来表示。
> 4. 收盘价（Close）：表示在相同时间段结束时的交易价格。在蜡烛图或K线图上，通常用一个矩形（称为实体）来表示。
>
> 通过OHLC结构，可以清晰地看到一段时间内资产价格的走势，比如在某个时间段内开盘价、最高价、最低价和收盘价的相对位置，有助于分析市场趋势和形态，判断买入和卖出时机，以及预测未来价格的可能变化。

### Order

订单结构，可由`exchange.GetOrder()`、`exchange.GetOrders()`函数返回。`exchange.GetOrders()`返回的是该结构的数组或者空数组（如果没有**当前未完成的订单**，返回`[]`，即空数组）。

```javascript
Copy code{
    Info        : {...},         // 请求交易所接口后，交易所接口应答的原始数据，回测时无此属性
    Id          : 123456,        // 交易单唯一标识
    Price       : 1000,          // 下单价格
    Amount      : 10,            // 下单数量
    DealAmount  : 10,            // 成交数量
    AvgPrice    : 1000,          // 成交均价
    Status      : 1,             // 订单状态，参考常量里的订单状态ORDER_STATE_CLOSED
    Type        : 0,             // 订单类型，参考常量里的订单类型ORDER_TYPE_BUY
    Offset      : 0              // 商品期货的订单数据中，订单的开平仓方向，ORDER_OFFSET_OPEN为开仓，ORDER_OFFSET_CLOSE为平仓方向
    ContractType : ""            // 该属性为具体的合约代码
}
```

### Depth

市场深度，由`exchange.GetDepth()`函数返回。

```javascript
{
    Asks    : [...],             // 卖单数组，MarketOrder数组,按价格从低向高排序
    Bids    : [...],             // 买单数组，MarketOrder数组,按价格从高向低排序
    Time    : 1567736576000      // 毫秒级别时间戳
}
```

> 市场深度（Market Depth），也称为订单簿（Order Book），是在金融交易市场中用来表示当前的买盘和卖盘报价情况的数据。它展示了买方和卖方愿意以不同价格买入或卖出一种金融资产（如股票、期货、数字货币等）的数量。
>
> 市场深度的信息通常以列表的形式显示，其中包含了以下内容：
>
> 1. 买盘（Bids）：表示投资者愿意以不同价格购买资产的报价情况。买盘列表按照价格从高到低排列，最高的买价在列表的顶部。
>
> 2. 卖盘（Asks）：表示投资者愿意以不同价格出售资产的报价情况。卖盘列表按照价格从低到高排列，最低的卖价在列表的顶部。
>
> 每个买盘和卖盘条目都包含了以下信息：
>
> - 价格（Price）：表示投资者愿意购买或出售资产的价格。
> - 数量（Quantity）：表示投资者愿意购买或出售资产的数量。
>
> 通过市场深度，交易者可以了解当前市场上的供需情况和潜在的买卖意愿。市场深度图通常以可视化方式展示，其中买盘和卖盘的价格水平以横轴表示，数量以纵轴表示。这样的图形有助于交易者做出更明智的交易决策，比如判断市场的支撑和阻力水平、确认交易信号以及预测价格的短期走势。
>
> 市场深度在交易中非常重要，尤其对于大宗交易或高频交易等策略，它提供了更详细的市场信息和洞察力，帮助交易者更好地了解市场的实时动态和趋势。

> 在金融交易中，"Bids" 和 "Asks" 是两个常见的术语，用于描述买卖交易的报价情况。
>
> 1. Bids（买盘）：指投资者愿意以某个价格购买某个金融资产（如股票、期货合约或其他证券）。这些买方报价构成了市场上的买盘。"Bids" 中包含了各个不同价格的买单，价格从高到低排序，最高的买价称为买一价（"Buy Price"）。
> 2. Asks（卖盘）：指投资者愿意以某个价格出售某个金融资产。这些卖方报价构成了市场上的卖盘。"Asks" 中包含了各个不同价格的卖单，价格从低到高排序，最低的卖价称为卖一价（"Sell Price"）。
>
> 在交易市场中，买卖双方的报价汇聚在一起形成了市场的买盘和卖盘，也称为"挂单"（Order Book）。当买一价与卖一价的价格相等或非常接近时，就形成了一个交易的机会，买卖双方的订单会成交，从而完成交易。
>
> 这两个变量的由来主要是因为交易所的交易系统需要记录和管理市场上的订单，以便撮合买卖交易。交易所会将买入和卖出的报价按照价格排序，形成"Bids"和"Asks"列表，并根据市场需求和供给的情况动态调整这些列表。这样的做法可以方便交易者了解当前市场上的买卖情况，并作出相应的交易决策。
>
> 总结：Bids代表买盘，是投资者愿意购买资产的价格和数量；Asks代表卖盘，是投资者愿意出售资产的价格和数量。

### MarketOrder

市场深度单，即`exchange.GetDepth()`函数返回数据中**Bids**、**Asks**数组中的元素的数据结构。

```javascript
{
    Price   : 1000,              // 价格
    Amount  : 1                  // 数量
}
```

### Account

账户信息，由`exchange.GetAccount()`函数返回。

```javascript
{
    Info            : {...},     // 请求交易所接口后，交易所接口应答的原始数据，回测时无此属性
    Balance         : 1000,      // 可用余额
    FrozenBalance   : 0,         // 挂单冻结的余额
    Stocks          : 1,         // 传统期货、股票证券此属性固定为0
    FrozenStocks    : 0          // 传统期货、股票证券此属性固定为0
}
```

### Position

期货交易中持有的仓位信息，由`exchange.GetPosition()`函数返回此`Position`结构的数组。

```javascript
Copy code{
    Info            : {...},     // 请求交易所接口后，交易所接口应答的原始数据，回测时无此属性
    MarginLevel     : 10,        // 杆杠大小，商品期货无法修改杠杆值
    Amount          : 100,       // 持仓量
    FrozenAmount    : 0,         // 挂单平仓时，仓位冻结量
    Price           : 10000,     // 持仓均价
    Profit          : 0,         // 股票不支持此字段，商品期货为盯市盈亏
    // CTP中用closebuy_today平今多头仓位，对应的Type属性为PD_LONG；用closesell_today平今空头仓位，对应的Type属性为PD_SHORT；用closebuy平昨多头仓位，对应的Type属性为PD_LONG_YD；用closesell平昨空头仓位，对应的Type属性为PD_SHORT_YD
    Type            : 0,
    ContractType    : "rb2201",  // 合约代码、股票代码
    Margin          : 1          // 仓位占用的保证金
}
```

> 在金融领域，杠杆（Leverage）是一种借助借款或其他财务工具来增加投资回报的手段。它允许投资者用较少的自有资金参与更大规模的交易或投资，从而放大盈利机会，但同时也增加了风险。
>
> 杠杆的大小通常用一个数字来表示，称为"杠杆倍数"（Leverage Ratio）。杠杆倍数是指投资者使用借款资金相对于自有资金的比例。举个例子：
>
> 假设您有10,000美元的自有资金，而您选择使用2倍杠杆进行投资。这意味着您可以借入额外的10,000美元，使您总共有20,000美元可以用于投资。这样，您的杠杆倍数就是2（$20,000 / $10,000）。
>
> 使用杠杆的好处在于，如果投资表现良好，您的收益将会相对于自有资金成倍增加。但是，需要注意的是，杠杆也带来了更高的风险。如果投资表现不佳，亏损也会相对增大，甚至可能超过您的初始投资金额。
>
> 不同的金融市场和交易平台提供不同的杠杆倍数。一般来说，股票市场的杠杆倍数相对较低，一般是1倍或较低，因为股票交易通常不允许高额杠杆。而外汇市场、期货市场和加密货币市场等通常提供较高的杠杆倍数，可以达到数十倍甚至更高，但也相应地伴随着更高的风险。
>
> 投资者在使用杠杆时应该非常谨慎，确保了解杠杆交易的风险和潜在影响，并根据自身的风险承受能力和投资目标来选择适当的杠杆倍数。

> 持仓量（Open Interest）是指某个金融衍生品（如期货合约或期权合约）的未平仓合约数量。在交易市场中，每笔交易都会导致两个相对的头寸——一个买方和一个卖方。因此，持仓量代表了尚未平仓的合约总数，即市场上目前仍然存在的未结算交易。
>
> 持仓量是一个动态的指标，它会在每一次买卖交易中增加或减少。当一方（买方或卖方）开仓时，持仓量会增加，当该方平仓时，持仓量会减少。但无论何时发生交易，持仓量的总和都保持不变，因为每笔交易都会有一个买方和一个卖方，导致持仓量的增加和减少相互抵消。
>
> 持仓量对于市场参与者来说是一个重要的指标，因为它反映了市场中的活跃度和流动性。较高的持仓量意味着有更多的交易活动和参与者，这通常被视为市场更加活跃。较低的持仓量可能意味着市场较为冷清或处于观望状态。
>
> 在期货市场中，持仓量的变化还可以提供一些有用的信息。例如，持仓量的增加可能表示市场参与者对于未来市场走势持有不同的看法，这可能是市场趋势发生变化的信号之一。
>
> 总结：持仓量是指金融衍生品市场上尚未平仓的合约数量，它可以反映市场的活跃度和流动性，并为市场参与者提供有关市场情况和趋势的信息。